"use strict";(self.webpackChunkzom=self.webpackChunkzom||[]).push([[242],{7242:(C,m,r)=>{r.r(m),r.d(m,{VideoCallModule:()=>f});var d=r(6895),c=r(6773),n=r(433),l=r(8256);let h=(()=>{class o{constructor(e,t){this.fb=e,this.router=t,this.seleccionSala=this.fb.group({roomInput:[,n.kI.required]})}ngOnInit(){}enviarSala(){this.router.navigate(["/videoCall/video"],{queryParams:{room:this.seleccionSala.value.roomInput}})}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(n.qu),l.Y36(c.F0))},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-room"]],decls:5,vars:1,consts:[[3,"formGroup"],["formControlName","roomInput","placeholder","Ingrese una sala"],[3,"click"]],template:function(e,t){1&e&&(l.TgZ(0,"section")(1,"form",0),l._UZ(2,"input",1),l.TgZ(3,"button",2),l.NdJ("click",function(){return t.enviarSala()}),l._uU(4,"Enviar"),l.qZA()()()),2&e&&(l.xp6(1),l.Q6J("formGroup",t.seleccionSala))},dependencies:[n._Y,n.Fj,n.JJ,n.JL,n.sg,n.u]}),o})();var s=r(1444);function u(o,i){1&o&&l._UZ(0,"div",2),2&o&&l.Q6J("id",i.$implicit)}const p=[{path:"",children:[{path:"video",component:(()=>{class o{constructor(e){this.ngxAgoraServ=e,this.title="Angular-Video",this.remoteCalls=[],this.localCallId="agora_local",this.uid=Math.floor(100*Math.random())}ngOnInit(){this.client=this.ngxAgoraServ.createClient({mode:"rtc",codec:"h264"}),this.assignClientHandlers(),this.localStream=this.ngxAgoraServ.createStream({streamID:this.uid,audio:!0,video:!0,screen:!1}),this.assignLocalStreamHandlers(),this.initLocalStream(),this.initLocalStream(()=>this.join(e=>this.publish(),e=>console.error(e)))}join(e,t){this.client.join(null,"foo-bar",this.uid,e,t)}publish(){this.client.publish(this.localStream,e=>console.log("Publish local stream error: "+e))}assignLocalStreamHandlers(){this.localStream.on(s.uy.MediaAccessAllowed,()=>{console.log("accessAllowed")}),this.localStream.on(s.uy.MediaAccessDenied,()=>{console.log("accessDenied")})}initLocalStream(e){this.localStream.init(()=>{this.localStream.play(this.localCallId),e&&e()},t=>console.error("getUserMedia failed",t))}assignClientHandlers(){this.client.on(s.rp.LocalStreamPublished,e=>{console.log("Publish local stream successfully")}),this.client.on(s.rp.Error,e=>{console.log("Got error msg:",e.reason),"DYNAMIC_KEY_TIMEOUT"===e.reason&&this.client.renewChannelKey("",()=>console.log("Renewed the channel key successfully."),t=>console.error("Renew channel key failed: ",t))}),this.client.on(s.rp.RemoteStreamAdded,e=>{this.client.subscribe(e.stream,{audio:!0,video:!0},a=>{console.log("Subscribe stream failed",a)})}),this.client.on(s.rp.RemoteStreamSubscribed,e=>{const t=e.stream,a=this.getRemoteId(t);this.remoteCalls.length||(this.remoteCalls.push(a),setTimeout(()=>t.play(a),1e3))}),this.client.on(s.rp.RemoteStreamRemoved,e=>{const t=e.stream;t&&(t.stop(),this.remoteCalls=[],console.log(`Remote stream is removed ${t.getId()}`))}),this.client.on(s.rp.PeerLeave,e=>{const t=e.stream;t&&(t.stop(),this.remoteCalls=this.remoteCalls.filter(a=>a!==`${this.getRemoteId(t)}`),console.log(`${e.uid} left from this channel`))})}getRemoteId(e){return`agora_remote-${e.getId()}`}}return o.\u0275fac=function(e){return new(e||o)(l.Y36(s.TE))},o.\u0275cmp=l.Xpm({type:o,selectors:[["app-video-room"]],decls:2,vars:2,consts:[[1,"local",3,"id"],["class","remote",3,"id",4,"ngFor","ngForOf"],[1,"remote",3,"id"]],template:function(e,t){1&e&&(l._UZ(0,"div",0),l.YNc(1,u,1,1,"div",1)),2&e&&(l.Q6J("id",t.localCallId),l.xp6(1),l.Q6J("ngForOf",t.remoteCalls))},dependencies:[d.sg],styles:[".local[_ngcontent-%COMP%]{position:fixed;right:1rem;bottom:1rem;width:20vw;height:20vh;border-radius:5px;overflow:hidden;z-index:1}.remote[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh}"]}),o})()},{path:"room",component:h},{path:"**",redirectTo:"contacts"}]}];let g=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[c.Bz.forChild(p),c.Bz]}),o})(),f=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[d.ez,g,n.UX,n.u5]}),o})()}}]);